/*! mne - v0.1.0 - 2015-04-01
* https://github.com/agramfort/mne-js
* Copyright (c) 2015 MNEJS contributors; Licensed TBD */
function authenticate(a){return"admin"===a.id.value?"eegdrop"===a.pass.value?(document.getElementById("dropZoneText").style.display="block",document.getElementById("authentication").style.display="none",initializeDragDrop(),initializeFileSelect()):(swal({title:_("Error"),text:_("Invalid Password"),type:"error",confirmButtonText:_("Try again")}),a.pass.value=""):(swal({title:_("Error"),text:_("Invalid UserID"),type:"error",confirmButtonText:_("Try again")}),a.id.value="",a.pass.value=""),!1}function RawBDF(a){parseData(this,a,"bdf")}function RawEDF(a){parseData(this,a,"edf")}function getFileInfo(a){var b={};b.fileName=a.name;var c=b.fileName.substr((~-b.fileName.lastIndexOf(".")>>>0)+2).toLowerCase();return b.fileExt="rec"===c?"edf":c,b}function parse(a,b){var c,d=new Scanner(a);return"edf"===b.fileExt?c=new RawEDF(d):"bdf"===b.fileExt&&(c=new RawBDF(d)),c.info.fileName=b.fileName,c}function cleanGraph(){document.getElementById("graph").innerHTML="",document.getElementById("dropZoneText").style.display="none",document.getElementById("plotInfo").innerHTML="",document.getElementById("sumPlot").innerHTML="",document.getElementById("sliderDiv").innerHTML="",document.getElementById("toolTipText").innerHTML=""}function setupLoading(){document.getElementById("newFile").style.display="none",document.getElementById("durationControl").style.display="none",document.getElementById("loadingIndicator").style.display="block"}function cleanLoading(){document.getElementById("loadingIndicator").style.display="none",document.getElementById("newFile").style.display="block",document.getElementById("durationControl").style.display="block"}function loadFile(a){var b=getFileInfo(a);if("bdf"!==b.fileExt&&"edf"!==b.fileExt)swal({title:"Error",text:"Only .edf and .bdf files are supported for now",type:"error",confirmButtonText:"Try again"});else{cleanGraph(),setupLoading();var c=new FileReader;c.onerror=errorHandler,c.onload=loadHandler(a,b),c.readAsArrayBuffer(a)}}function handleFileSelection(a){var b=a.target.files;loadFile(b[0])}function handleFileDrag(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"}function handleFileDrop(a){a.stopPropagation(),a.preventDefault();var b=a.dataTransfer.files;loadFile(b[0])}function isEegChan(a){for(var b=0;b<nonEegChans.length;b++)if(-1!==a.toLowerCase().indexOf(nonEegChans[b]))return!1;for(b=0;b<eegChans.length;b++)if(-1!==a.toLowerCase().indexOf(eegChans[b]))return!0;return!1}function parseData(a,b,c){b.littleEndian=!0,a.info={},"edf"===c?a.info.icode=parseFloat(b.scanAttribute(b,"uchar",8)):"bdf"===c&&(a.info.icode=b.scan("uchar",8)),a.info.patientID=b.scanAttribute(b,"schar",80).trim();var d=(b.scanAttribute(b,"schar",80).trim(),b.scanAttribute(b,"schar",8).trim(),b.scanAttribute(b,"schar",8).trim(),parseFloat(b.scanAttribute(b,"schar",8)),b.scan("uchar",44),parseFloat(b.scanAttribute(b,"char",8))),e=parseFloat(b.scanAttribute(b,"char",8));a.info.maxDuration=d*e,a.info.nchan=parseFloat(b.scanAttribute(b,"char",4)),a.info.chanNames=b.scanStringAttributeArray(b,a.info.nchan,"char",16);b.scanStringAttributeArray(b,a.info.nchan,"char",80);a.info.units=b.scanStringAttributeArray(b,a.info.nchan,"char",8);var f=b.scanFloatAttributeArray(b,a.info.nchan,"char",8),g=b.scanFloatAttributeArray(b,a.info.nchan,"char",8),h=b.scanFloatAttributeArray(b,a.info.nchan,"char",8),i=b.scanFloatAttributeArray(b,a.info.nchan,"char",8),j=[];a.info.sfreq=[],a.info.lowpass=[],a.info.highpass=[];var k,l,m,n;for(k=0;k<a.info.nchan;k++)n=b.scanAttribute(b,"char",80).trim(),a.info.lowpass[k]=String(n.match(/LP:\s+(\w+)/g)).split(" ").slice(-1)[0],a.info.highpass[k]=String(n.match(/HP:\s+(\w+)/g)).split(" ").slice(-1)[0];for(k=0;k<a.info.nchan;k++)j[k]=parseFloat(b.scanAttribute(b,"char",8)),a.info.sfreq[k]=j[k]/e,a.info.lowpass[k]=a.info.lowpass[k].localeCompare("NaN")||a.info.lowpass[k].localeCompare("DC")?j[k]/2:parseFloat(a.info.lowpass[k]),a.info.highpass[k]=a.info.highpass[k].localeCompare("NaN")||a.info.highpass[k].localeCompare("DC")?0:parseFloat(a.info.highpass[k]);var o;for(k=0;k<a.info.nchan;k++)o=b.scan("char",32);for(a.info.channels=[],k=0;k<a.info.nchan;k++){var p="nonEeg";isEegChan(a.info.chanNames[k])&&(p="eeg"),a.info.channels.push({name:a.info.chanNames[k],chanType:p,pos:[1,2,3],isChanGood:!0})}for(a.info.scaleFac=[],k=0;k<a.info.nchan;k++)a.info.scaleFac[k]=(g[k]-f[k])/(i[k]-h[k]),"uV"===a.info.units[k]&&(a.info.scaleFac[k]*=1e-6),"nonEeg"===a.info.channels[k].chanType&&(a.info.scaleFac[k]=1);for(a.data=new Array(a.info.nchan),k=0;k<a.info.nchan;k++)a.data[k]=[];var q,r,s;if("edf"===c)for(k=0;d>k;k++)for(l=0;l<a.info.nchan;l++)for(q=j[l],scaleFac=a.info.scaleFac[l],s=b.scan("sshort",q),m=0;q>m;m++)a.data[l].push(s[m]*scaleFac);else if("bdf"===c){var t=1<<24,u=1<<23;for(k=0;d>k;k++)for(l=0;l<a.info.nchan;l++)for(q=3*j[l],scaleFac=a.info.scaleFac[l],s=b.scan("uchar",q),m=0;q>m;m+=3)r=s[m]+(s[m+1]<<8)+(s[m+2]<<16),r=r>=u?r-t:r,a.data[l].push(r*scaleFac)}}function initializeFileSelect(){document.getElementById("fileSelector").addEventListener("change",handleFileSelection,!1)}function initializeDragDrop(){var a=document.getElementById("main");a.addEventListener("dragover",handleFileDrag,!1),a.addEventListener("drop",handleFileDrop,!1)}function addMarkerListener(a,b){null!=a.text&&a.text.addEventListener("click",function(){b.colorChannel(a)})}function initiateChanMarker(a){for(var b=[],c=[],d=[],e=Math.min(a.chanPerPage,a.numChan-a.activeChan[0]),f=0;e>f;f++){b[f]=document.getElementById("text-"+f),c[f]=document.getElementById("path-"+f),d[f]=document.getElementById("axis-"+f);var g={index:a.activeChan[0]+f,text:b[f],path:c[f],axis:d[f]};addMarkerListener(g,a)}}function triggerRescaling(a){var b=a.tMin+a.windowLen;b>a.maxDuration?(a.tMin=Math.max(0,a.maxDuration-a.windowLen),a.tMax=a.maxDuration):a.tMax=a.tMin+a.windowLen,a.redrawOnScaling()}function catchDurationSelect(a){$(".dropdown-menu li a").click(function(){var b=parseFloat($(this).text());a.maxDuration>=b&&a.windowLen!==b&&(a.windowLen=b,triggerRescaling(a))})}function catchKeyPress(a){var b={16:!1,38:!1,40:!1,37:!1,39:!1};$(window).bind("mousewheel DOMMouseScroll",function(b){b.shiftKey?b.originalEvent.wheelDelta>0||b.originalEvent.detail<0?a.backward(!0):a.forward(!0):b.originalEvent.wheelDelta>0||b.originalEvent.detail<0?a.upward():a.downward()}),$(document).keydown(function(c){c.keyCode in b&&(b[c.keyCode]=!0,b[16]&&b[38]&&a.incGain(),b[16]&&b[40]&&a.decGain(),b[16]&&b[39]&&a.forward(!1),b[16]&&b[37]&&a.backward(!1),b[39]&&a.forward(!0),b[37]&&a.backward(!0),b[38]&&!b[16]&&a.upward(),b[40]&&!b[16]&&a.downward())}).keyup(function(a){a.keyCode in b&&(b[a.keyCode]=!1)})}function quantizeSeconds(a,b){var c;b&&(c=a%1e3,a=parseInt(a/1e3));var d=parseInt(a/3600),e=parseInt(a/60)%60,f=a%60,g=(d>0?d+"h ":"")+(e>0?e+"m ":"")+(f+"s ");return b&&(g=g+c+"ms"),g}function RawPlotter(a,b,c){c||(c={}),this.raw=a,this.selector=b,this.options=c,this.fileName=this.raw.info.fileName,this.data=this.raw.data,this.channels=this.raw.info.channels,this.chanNames=this.raw.info.chanNames,this.numChan=this.raw.info.nchan,this.sfreq=this.raw.info.sfreq,this.margin={top:0,right:0,bottom:25,left:70},this.chanPerPage=c.chanPerPage||Math.min(15,this.numChan),this.maxDuration=this.raw.info.maxDuration;var d=this.maxDuration<10?2:10;this.windowLen=c.windowLen||d,this.isSmallDuration=this.maxDuration<2?!0:!1;var e=[1,2,10,30,60];durationElement=document.getElementById("duration-menu"),durationElement.innerHTML="";for(var f=0;f<e.length;f++){var g=e[f];g<=this.maxDuration&&(durationElement.innerHTML+="<li><a>"+g+"s</a></li>")}this.forwardLimit=this.maxDuration,this.backwardLimit=0,this.upLimit=this.chanPerPage,this.downLimit=this.numChan-this.chanPerPage-1,this.tMin=0,this.tMax=this.windowLen,this.currentSliderPos=0,this.gain=[],this.numBadChan=0;var h=Number.MIN_VALUE;for(f=0;f<this.numChan;f++){this.gain.push(1);var i=this.channels[f].chanType;"nonEeg"===i&&(this.numBadChan+=1);var j=this.data[f].length;j>h&&(h=j)}for(this.gainMultiplier=1.5,this.badChannelColor="rgba(145, 145, 145, 0.30)",this.sampleChunkSize=Math.round(h/2e3),this.numSampleChunks=Math.round(h/this.sampleChunkSize),this.downSampleSumData(),this.activeChan=[],f=0;f<this.chanPerPage;f++)this.activeChan.push(f);this.removeDC(),this.setEegdomain()}if("function"==typeof require){var parseData=require("./parser.js");module.exports=RawBDF}if("function"==typeof require){var parseData=require("./parser.js");module.exports=RawEDF}var loadHandler=function(a,b){return function(a){var c=a.target.result,d=parse(c,b),e=new RawPlotter(d,"#graph");e.setup(),e.draw(),catchKeyPress(e),e.isSmallDuration||catchDurationSelect(e),e.redrawOnResize(),e.drawSlider(),e.plotSumData(),console.plotGraph=e,cleanLoading()}},errorHandler=function(a){window.console.log("Error:"+a.target.error.code)},stringsFR={"Web based EEG data browser":"Navigateur de données EEG sur le web","Login:":"Identifiant:",Login:"S'identifier",login:"identifiant",Password:"Mot de passe",password:"mot de passe","Load file":"Charger un fichier","Drop your EEG file here":"Déposez votre fichier EEG ici","or click here to select your file":"ou cliquez ici pour sélectionner votre fichier","(Formats currently supported: EDF and BDF)":"(Formats actuellement pris en charge: EDF et BDF)","Only .edf and .bdf files are supported for now":"Fichiers .edf et .bdf Seuls sont pris en charge pour le moment","File Name":"Nom de fichier","Total Length":"Longueur totale","Time Frame":"Durée","Current Time":"Temps",Error:"Erreur","Invalid UserID":"Identifiant erronné","Invalid Password":"Mot de passe erronné","Try again":"Réessayer",Duration:"Durée"},mneFR=function(a){return a in stringsFR?stringsFR[a]:a},mneEN=function(a){return a},mneTranslate=function(){var a=$("title");a[0].innerHTML=_(a[0].innerHTML);for(var b=$("input"),c=$("text"),d=0;d<b.length;d++)b[d].value=_(b[d].value),b[d].placeholder=_(b[d].placeholder);for(d=0;d<c.length;d++)c[d].innerHTML=_(c[d].innerHTML)};if("function"==typeof require){var Scanner=require("../../src/io/scanner.js");module.exports=parseData}var eegChans=["a1","a2","a3","a4","a5","a6","a7","a8","a9","a10","a11","a12","a13","a14","a15","a16","b1","b2","b3","b4","b5","b6","b7","b8","b9","b10","b11","b12","b13","b14","b15","b16","c1","c2","c3","c4","c5","c6","c7","c8","c9","c10","c11","c12","c13","c14","c15","c16","d1","d2","d3","d4","d5","d6","d7","d8","d9","d10","d11","d12","d13","d14","d15","d16","e1","e2","e3","e4","e5","e6","e7","e8","e9","e10","e11","e12","e13","e14","e15","e16","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","f13","f14","f15","f16","g1","g2","g3","g4","g5","g6","g7","g8","g9","g10","g11","g12","g13","g14","g15","g16","h1","h2","h3","h4","h5","h6","h7","h8","h9","h10","h11","h12","h13","h14","h15","h16","i1","i2","i3","i4","i5","i6","i7","i8","fp1","af7","af3","f1","f3","f5","f7","ft7","fc5","fc3","fc1","c1","c3","c5","t7","tp7","cp5","cp3","cp1","p1","p3","p5","p7","p9","po7","po3","o1","iz","oz","poz","pz","cpz","fpz","fp2","af8","af4","afz","fz","f2","f4","f6","f8","ft8","fc6","fc4","fc2","fcz","cz","c2","c4","c6","t8","tp8","cp6","cp4","cp2","p2","p4","p6","p8","p10","po8","po4","o2","eeg"],nonEegChans=["spo2","emg","ecg","eog"],Scanner=function(a){this.data=a,this.dataPointer=0,this.nativeLittleEndian=new Int8Array(new Int16Array([1]).buffer)[0]>0,this.littleEndian=!1};Scanner.prototype.scanAttribute=function(a,b,c){var d,e="";d=a.scan(b,c);for(var f=d.length,g=0;f>g;g++)e+=String.fromCharCode(d[g]);return e},Scanner.prototype.scanStringAttributeArray=function(a,b,c,d){for(var e=[],f=0;b>f;f++)e[f]=this.scanAttribute(a,c,d).trim();return e},Scanner.prototype.scanFloatAttributeArray=function(a,b,c,d){for(var e=[],f=0;b>f;f++)e[f]=parseFloat(this.scanAttribute(a,c,d));return e},Scanner.prototype.scan=function(a,b){"undefined"==typeof b&&(b=1);var c=1,d=Uint8Array;switch(a){case"uchar":break;case"schar":d=Int8Array;break;case"ushort":d=Uint16Array,c=2;break;case"sshort":d=Int16Array,c=2;break;case"uint":d=Uint32Array,c=4;break;case"sint":d=Int32Array,c=4;break;case"float":d=Float32Array,c=4;break;case"float64":d=Float64Array,c=8}var e=new d(this.data.slice(this.dataPointer,this.dataPointer+=b*c));return this.nativeLittleEndian!==this.littleEndian&&(e=this.flipEndianness(e,c)),1===b?[e[0]]:e},Scanner.prototype.flipEndianness=function(a,b){for(var c=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),d=0;d<a.byteLength;d+=b)for(var e=d+b-1,f=d;e>f;e--,f++){var g=c[f];c[f]=c[e],c[e]=g}return a},"function"==typeof require&&(module.exports=Scanner),RawPlotter.prototype.setup=function(){this.svgWidth=document.getElementById("graph").clientWidth,this.width=this.svgWidth-this.margin.left-this.margin.right,this.svgHeight=document.getElementById("graph").clientHeight,this.height=this.svgHeight-this.margin.top-this.margin.bottom,this.plotSpacing=this.height/this.chanPerPage,this.textFont=this.svgHeight/40,document.getElementById("plotInfo").setAttribute("style","font-size:"+this.textFont+"px"),document.getElementById("toolTipText").setAttribute("style","font-size:"+this.textFont+"px");var a=.0086;this.slidNegMarg=this.svgHeight*a,document.getElementById("interaction").setAttribute("style","margin-bottom:"+this.slidNegMarg+"em"),this.yOffset=[],this.textOffsetArr=[];for(var b=this.svgHeight/40,c=0;c<this.chanPerPage;c++)this.yOffset.push(c*this.plotSpacing),this.textOffsetArr.push(this.yOffset[c]+b);this.setEegLines(),this.graph=d3.select(this.selector).append("svg").attr("width",this.svgWidth+10).attr("height",this.svgHeight).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.drawToolTip()},RawPlotter.prototype.draw=function(){{var a=this.dataSliceTime(this.dataSliceChan());this.chanNames.slice(this.activeChan[0],this.activeChan[this.chanPerPage])}this.graph.selectAll("text").remove(),this.graph.selectAll("path").remove();var b=Math.min(this.chanPerPage,this.numChan-this.activeChan[0]),c=this.svgWidth/43;for(i=0;i<b;i++){for(var d=[],e=0;e<a[i].length;e++)a[i][e]*=this.gain[i],d.push(0);var f=i+this.activeChan[0];switch(this.currentSfreq=this.sfreq[f],this.channels[f].chanType){case"eeg":this.line=this.lineEeg;break;case"nonEeg":this.line=this.getNonEegLine(f)}this.graph.append("text").attr("id","text-"+i).attr("transform","translate(-"+c+","+this.textOffsetArr[i]+")").text(this.channels[f].name).style({fill:this.channels[f].isChanGood?"black":this.badChannelColor,"font-size":this.textFont+"px"}),this.graph.append("path").attr("id","path-"+i).attr("transform","translate(0,"+this.yOffset[i]+")").style({stroke:this.channels[f].isChanGood?"steelblue":this.badChannelColor}).attr("d",this.line(a[i])),this.graph.append("path").attr("id","axis-"+i).attr("transform","translate(0,"+this.yOffset[i]+")").style({stroke:this.channels[f].isChanGood?"grey":this.badChannelColor}).attr("d",this.line(d))}var g=document.getElementById("plotInfo");g.innerHTML="<i>"+_("File Name")+":</i> <b>"+this.fileName+"</b> / <i>"+_("Total Length")+":</i> <b>"+quantizeSeconds(this.maxDuration,!1)+"</b> / <i>"+_("Time Frame")+": </i><b>"+quantizeSeconds(this.tMin,!1)+" - "+quantizeSeconds(this.tMax,!1)+"</b>",initiateChanMarker(this)},RawPlotter.prototype.drawSlider=function(){function a(){var a=h.extent()[0];if(d3.event.sourceEvent){var d=a;a=Math.round(f.invert(d3.mouse(this)[0])),a=Math.min(Math.max(0,a-Math.round(b.windowLen/2)),c),h.extent([a,a]),d===a||this.isSmallDuration||b.redrawOnSlide(a)}m.attr("x",f(a))}document.getElementById("sliderDiv").innerHTML="";var b=this,c=this.maxDuration-this.windowLen,d=this.maxDuration,e=10;this.sliderSvgWidth=this.svgWidth+10,this.sliderSvgHeight=this.svgHeight/10;var f=d3.scale.linear().domain([0,d]).range([0,this.width]).clamp(!0),g=d3.select("#sliderDiv").append("svg").attr("width",this.sliderSvgWidth).attr("height",this.sliderSvgHeight).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")");g.append("g").attr("class","x axis").attr("transform","translate(0,"+this.sliderSvgHeight/2+")").call(d3.svg.axis().scale(f).orient("bottom").ticks(0).tickSize(0)).select(".domain").attr("class","halo");var h=d3.svg.brush().x(f).extent([0,0]).on("brush",a);this.brush=h,this.slider=g.append("g").attr("class","slider").call(h),this.slider.select(".background").attr("height",this.sliderSvgHeight/2).style("cursor","move");var i=(this.sliderSvgHeight-e)/2,j=this.svgWidth-this.margin.left,k=5,l=Math.max(k,Math.min(j,this.windowLen*j/this.maxDuration)),m=this.slider.append("rect").attr("class","handle").attr("width",l).attr("height",e).attr("transform","translate(0,"+i+")")},RawPlotter.prototype.moveSlider=function(a){(this.currentSliderPos!==this.tMin||a)&&(this.slider.call(this.brush.event).call(this.brush.extent([this.tMin,this.tMin])).call(this.brush.event),this.currentSliderPos=this.tMin)},RawPlotter.prototype.plotSumData=function(){document.getElementById("sumPlot").innerHTML="",document.getElementById("sumPlot").setAttribute("style","margin-top:"+-.5*this.slidNegMarg+"em");var a=this.svgHeight/10,b=d3.scale.linear().domain([0,this.maxDuration]).range([0,this.width]),c=d3.scale.linear().domain([d3.min(this.sumData),d3.max(this.sumData)]).range([a,0]),d=d3.max(this.sfreq)/this.sampleChunkSize;this.sumPlotSVG=d3.select("#sumPlot").append("svg").attr("width",this.svgWidth).attr("height",a).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.sumArea=d3.svg.area().x(function(a,c){return b(c/d)}).y0(a).y1(function(a){return c(a)}),this.sumLine=d3.svg.line().x(function(a,c){return b(c/d)}).y(function(a){return c(a)}),this.sumPlotSVG.append("path").datum(this.sumData).attr("class","area").attr("d",this.sumArea),this.sumPlotSVG.append("path").attr("id","sumPath").style({stroke:"black"}).attr("d",this.sumLine(this.sumData))},RawPlotter.prototype.redrawPlotSumData=function(a,b){var c=this.channels[a].chanType;if("nonEeg"!==c){var d;if(this.numBadChan===this.numChan)for(d=0;d<this.numSampleChunks;d++)this.sumData[d]=0;else{var e,f,g,h,i;for(d=0;d<this.numSampleChunks;d++){e=0,g=d*this.sampleChunkSize,h=g,i=g+this.sampleChunkSize;for(var j=h;i>j&&!isNaN(this.data[a][j]);j++)e+=Math.pow(this.data[a][j],2);f=Math.pow(this.sumData[d],2),b?f+=e/this.sampleChunkSize:f-=e/this.sampleChunkSize,this.sumData[d]=Math.sqrt(Math.max(0,f))}}this.plotSumData()}},RawPlotter.prototype.drawToolTip=function(){var a=this,b=d3.scale.linear().domain([0,this.windowLen]).range([0,this.width]).clamp(!0),c=this.graph.append("g").style("display","none");c.append("line").attr("class","x").style("stroke","black").style("stroke-dasharray","3,3").attr("y1",0).attr("y2",this.height),this.graph.append("rect").attr("width",this.width).attr("height",this.height).style("fill","none").style("pointer-events","all"),this.graph.on("mouseover",function(){c.style("display","block")}).on("mouseout",function(){c.style("display","none")}).on("mousemove",function(){a.toolTipX=b.invert(d3.mouse(this)[0]),c.select("line.x").attr("transform","translate("+b(a.toolTipX)+", 0)"),a.changeToolTipText()})},RawPlotter.prototype.changeToolTipText=function(){var a=document.getElementById("toolTipText"),b=parseInt(1e3*(this.toolTipX+this.tMin));a.innerHTML="<i>"+_("Current Time")+": </i><b>"+quantizeSeconds(b,!0)+"</b>"},RawPlotter.prototype.forward=function(a){if(!this.isSmallDuration){var b=a?1:this.windowLen-1;this.tMax+b>this.maxDuration?(this.tMax=this.maxDuration,this.tMin=Math.max(0,this.maxDuration-this.windowLen),this.draw(),this.moveSlider()):this.tMax<this.forwardLimit&&(this.tMin+=b,this.tMax+=b,this.draw(),this.moveSlider()),this.changeToolTipText()}},RawPlotter.prototype.backward=function(a){if(!this.isSmallDuration){var b=a?1:this.windowLen-1;this.tMin-b<0?(this.tMin=0,this.tMax=Math.min(this.windowLen,this.maxDuration),this.draw(),this.moveSlider()):this.tMin>this.backwardLimit&&(this.tMin-=b,this.tMax-=b,this.draw(),this.moveSlider()),this.changeToolTipText()}},RawPlotter.prototype.upward=function(){if(this.activeChan[0]>=this.upLimit){for(var a=0;a<this.chanPerPage;a++)this.activeChan[a]-=this.chanPerPage;this.draw()}},RawPlotter.prototype.downward=function(){var a=this.activeChan.slice(-1)[0];if(a<=this.downLimit||a<this.numChan-1){for(var b=0;b<this.chanPerPage;b++)this.activeChan[b]+=this.chanPerPage;this.draw()}},RawPlotter.prototype.incGain=function(){for(var a=0;a<this.numChan;a++)this.gain[a]*=this.gainMultiplier;this.draw()},RawPlotter.prototype.decGain=function(){for(var a=0;a<this.numChan;a++)this.gain[a]/=this.gainMultiplier;this.draw()},RawPlotter.prototype.dataSliceTime=function(a){for(var b=[],c=Math.min(this.chanPerPage,this.numChan-this.activeChan[0]),d=0;c>d;d++){var e=this.sfreq[this.activeChan[d]];b.push(a[d].slice(this.tMin*e,this.tMax*e+1))}return b},RawPlotter.prototype.dataSliceChan=function(){return this.data.slice(this.activeChan[0],this.activeChan[this.chanPerPage])},RawPlotter.prototype.redrawOnResize=function(){var a=this;window.onresize=function(){document.getElementById("graph").innerHTML="",a.setup(),a.draw(),a.drawSlider(),a.moveSlider(!0),a.plotSumData()}},RawPlotter.prototype.redrawOnScaling=function(){document.getElementById("graph").innerHTML="",this.setup(),this.draw(),this.drawSlider(),this.moveSlider(!0)},RawPlotter.prototype.redrawOnSlide=function(a){this.tMin=a,this.tMax=a+this.windowLen,this.draw(),this.moveSlider()},RawPlotter.prototype.colorChannel=function(a){this.channels[a.index].isChanGood=!this.channels[a.index].isChanGood;var b=this.channels[a.index].chanType;this.channels[a.index].isChanGood?(a.text.setAttribute("style","fill:black;font-size:"+this.textFont+"px"),a.path.setAttribute("style","stroke:steelblue"),a.axis.setAttribute("style","stroke:grey"),"eeg"===b&&(this.numBadChan-=1),this.redrawPlotSumData(a.index,!0)):(a.text.setAttribute("style","fill:"+this.badChannelColor+";font-size:"+this.textFont+"px"),a.path.setAttribute("style","stroke:"+this.badChannelColor),a.axis.setAttribute("style","stroke:"+this.badChannelColor),"eeg"===b&&(this.numBadChan+=1),this.redrawPlotSumData(a.index,!1))},RawPlotter.prototype.downSampleSumData=function(){for(var a,b,c,d=[],e=0;e<this.numSampleChunks;e++){for(d.push(0),a=e*this.sampleChunkSize,b=a,c=a+this.sampleChunkSize,i=0;i<this.numChan;i++){var f=this.channels[i].chanType;if("eeg"===f)for(var g=b;c>g&&!isNaN(this.data[i][g]);g++)d[e]+=Math.pow(this.data[i][g],2)}d[e]=Math.sqrt(d[e]/this.sampleChunkSize)}this.sumData=d.slice()},RawPlotter.prototype.removeDC=function(){for(i=0;i<this.numChan;i++){var a=this.data[i].reduce(function(a,b){return a+b},0),b=this.data[i].length,c=a/b;for(j=0;j<b;j++)this.data[i][j]-=c}},RawPlotter.prototype.setEegdomain=function(){var a=Number.MAX_VALUE,b=Number.MIN_VALUE;for(i=0;i<this.numChan;i++)if("eeg"===this.channels[i].chanType)for(j=0;j<this.data[i].length;j++)b=Math.max(b,this.data[i][j]),a=Math.min(a,this.data[i][j]);this.maxYEeg=Math.max(Math.abs(b),Math.abs(a)),this.minYEeg=-this.maxYEeg},RawPlotter.prototype.setEegLines=function(){var a=d3.scale.linear().domain([0,this.windowLen]).range([0,this.width]),b=d3.scale.linear().domain([this.minYEeg,this.maxYEeg]).range([this.height/this.chanPerPage,0]);this.lineEeg=d3.svg.line().x(function(b,c){return a(c/this.currentSfreq)}).y(function(a){return b(a)})},RawPlotter.prototype.getNonEegLine=function(a){var b=d3.scale.linear().domain([0,this.windowLen]).range([0,this.width]),c=d3.min(this.data[a]),d=d3.max(this.data[a]);d=Math.max(Math.abs(d),Math.abs(c)),c=-d;var e=d3.scale.linear().domain([c,d]).range([this.height/this.chanPerPage,0]),f=d3.svg.line().x(function(a,c){return b(c/this.currentSfreq)}).y(function(a){return e(a)});return f};