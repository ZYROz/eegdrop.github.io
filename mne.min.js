/*! mne - v0.1.0 - 2015-06-02
* https://github.com/agramfort/mne-js
* Copyright (c) 2015 MNEJS contributors; Licensed TBD */
if("function"==typeof require)var mne=require("../../src/mne.js");if(mneAuthenticate=function(a){return"admin"===a.id.value?"eegdrop"===a.pass.value?(document.getElementById("dropZoneText").style.display="block",document.getElementById("eegHeading").style.display="block",document.getElementById("authentication").style.display="none",mne.initializeDragDrop(),mne.initializeFileSelect()):(swal({title:_("Error"),text:_("Invalid Password"),type:"error",confirmButtonText:_("Try again")}),a.pass.value=""):(swal({title:_("Error"),text:_("Invalid UserID"),type:"error",confirmButtonText:_("Try again")}),a.id.value="",a.pass.value=""),!1},"function"==typeof require)var mne=require("../../src/mne.js");if(mne.cleanGraph=function(){document.getElementById("graph").innerHTML="",document.getElementById("dropZoneText").style.display="none",document.getElementById("eegHeading").style.display="none",document.getElementById("sumPlot").innerHTML="",document.getElementById("sliderDiv").innerHTML="",document.getElementById("toolTipText").innerHTML="";var a=document.getElementById("fileName");null!==a&&(a.innerHTML="")},mne.setupLoading=function(){document.getElementById("newFile").style.display="none",document.getElementById("chanSelectButton").style.display="none",document.getElementById("durationControl").style.display="none",document.getElementById("helpWinButton").style.display="none",document.getElementById("progressBar").style.display="block"},mne.cleanLoading=function(){document.getElementById("progressBar").style.display="none",document.getElementById("newFile").style.display="block",document.getElementById("chanSelectButton").style.display="block",document.getElementById("durationControl").style.display="block",document.getElementById("helpWinButton").style.display="block"},mne.initChanSelectAll=function(){$("#checkAll").click(function(){$(".check").prop("checked",$(this).prop("checked"))})},mne.errorHandler=function(a){window.console.log("Error:"+a.target.error.code)},mne.getFileInfo=function(a){var b={};b.fileName=a.name;var c=b.fileName.substr((~-b.fileName.lastIndexOf(".")>>>0)+2).toLowerCase();return b.fileExt="rec"===c?"edf":c,b},mne.runPlotter=function(){var a=new mne.RawPlotter(mne.raw,"#graph");mne.plotGraph=a,a.setup(),a.draw(),mne.catchKeyPress(),a.isSmallDuration||mne.catchDurationSelect(a),a.redrawOnResize(),a.drawSlider(),a.plotSumData(),mne.isDonePlotting=!0,mne.cleanLoading(),mne.initializeHelpWindow()},mne.redrawOnChanSelect=function(){var a=mne.raw.info.nchan,b=$("#chanSelect input");b=b.slice(1,b.length);for(var c=0,d=0;a>d;d++)b[d].checked?c++:mne.raw.info.channels[d].isChecked=!1;if(0!==c)mne.isChanSelectDone=!0,$("#chanSelectPopup").click(),$("#blackOverlay").hide(),mne.isDonePlotting&&(mne.cleanGraph(),mne.runPlotter());else for(swal({title:_("Error"),text:_("Select at least one channel"),type:"error",confirmButtonText:_("Try again")}),d=0;a>d;d++)mne.raw.info.channels[d].isChecked=!0},mne.drawChanSelectWindow=function(a){mne.isChanSelectDone=!1;for(var b=15,c=document.getElementById("chanSelectPopup"),d="<table><tr class='chanSelCenter'><td colspan='"+b+"'><div class='checkbox'><label><input type='checkbox'checked id='checkAll'>"+_("Select/Deselect all")+"</label></div></td></tr>",e=0;e<a.info.nchan;){d+="<tr>";for(var f=0;b>f&&(d+="<td><div class='checkbox'><label><input class='check' type='checkbox' checked>"+a.info.channels[e].name+"</label></div></td>",e++,e!==a.info.nchan);f++);d+="</tr>"}d+="<tr class='chanSelCenter'><td colspan='"+b+"'><button id='chanSelConfirm' class='btn btn-default'type='button' onclick='mne.redrawOnChanSelect();'><text>"+_("Ok")+"</text></button></td></tr></table>",c.setAttribute("data-content",d),c.setAttribute("title",_("Choose channels to display")),$("#chanSelectPopup").popover({placement:"bottom",trigger:"click"}),$("#chanSelectPopup").click(),$("#blackOverlay").show(),mne.initChanSelectAll()},mne.parseFile=function(a){var b=mne.getFileInfo(a);if("bdf"!==b.fileExt&&"edf"!==b.fileExt)return void swal({title:_("Error"),text:_("Only .edf and .bdf files are supported for now"),type:"error",confirmButtonText:_("Try again")});mne.cleanGraph(),mne.setupLoading();var c,d=new FileReader;d.onload=function(a){c=a.target.result;var d=new mne.Scanner(c),e=new mne.Raw(d,b.fileExt);mne.raw=e,mne.isDonePlotting=!1,e.parseInfo(),mne.drawChanSelectWindow(e),e.info.fileName=b.fileName;var f,g,h=document.getElementById("progressBarWidth"),i=function(){g=e.parseRecord(),g?(f=Math.ceil(100*e.iterationsDone/e.info.numRecords),h.setAttribute("style","width:"+f+"%"),h.innerHTML=f+"%",setTimeout(i,500)):(h.setAttribute("style","width: 100%"),h.innerHTML="100%",setTimeout(function(){mne.runPlotter()},750))};setTimeout(i,0)},d.readAsArrayBuffer(a)},mne.handleFileSelection=function(a){var b=a.target.files[0];mne.parseFile(b)},mne.handleFileDrag=function(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"},mne.handleFileDrop=function(a){a.stopPropagation(),a.preventDefault();var b=a.dataTransfer.files[0];mne.parseFile(b)},mne.initializeHelpWindow=function(){var a=document.getElementById("helpWindowPopup"),b="<div><table class='helpContentTable'><tr><td></td><td></td><td class='boldText'>"+_("Keyboard shortcuts")+"</td></tr><tr><td class='rightCell'>&lt"+_("Up")+"&gt</td><td> : </td><td>"+_("Scroll up through the channels")+"</td></tr><tr><td class='rightCell'>&lt"+_("Down")+"&gt</td><td> : </td><td>"+_("Scroll down through the channels")+"</td></tr><tr><td class='rightCell'>&lt"+_("Left")+"&gt</td><td> : </td><td>"+_("Move backward in time by 1s")+"</td></tr><tr><td class='rightCell'>&lt"+_("Right")+"&gt</td><td> : </td><td>"+_("Move forward in time by 1s")+"</td></tr><tr><td class='rightCell'>&lt"+_("Shift")+"&gt + &lt"+_("Up")+"&gt</td><td> : </td><td>"+_("Increase amplitude")+"</td></tr><tr><td class='rightCell'>&lt"+_("Shift")+"&gt + &lt"+_("Down")+"&gt</td><td> : </td><td>"+_("Decrease amplitude")+"</td></tr><tr><td class='rightCell'>&lt"+_("Shift")+"&gt + &lt"+_("Left")+"&gt</td><td> : </td><td>"+_("Move backward in time by 1 page")+"</td></tr><tr><td class='rightCell'>&lt"+_("Shift")+"&gt + &lt"+_("Right")+"&gt</td><td> : </td><td>"+_("Move forward in time by 1 page")+"</td></tr><tr><td><br/></td></tr><tr><td></td><td></td><td class='boldText'>"+_("Mouse events")+"</td></tr><tr><td class='rightCell'>"+_("Mouse wheel up")+"</td><td> : </td><td>"+_("Scroll up through the channels")+"</td></tr><tr><td class='rightCell'>"+_("Mouse wheel down")+"</td><td> : </td><td>"+_("Scroll down through the channels")+"</td></tr><tr><td class='rightCell'>&lt"+_("Shift")+"&gt + "+_("Mouse wheel up")+"</td><td> : </td><td>"+_("Move backward in time by 1s")+"</td></tr><tr><td class='rightCell'>&lt"+_("Shift")+"&gt + "+_("Mouse wheel down")+"</td><td> : </td><td>"+_("Move forward in time by 1s")+"</td></tr></table><br><table class='helpContentTable'><tr><td class='boldText'>"+_("Interaction")+"</td></tr><tr><td>1. "+_("Click on a channel name to mark it bad")+"</td></tr><tr><td>2. "+_("'Page duration' dropdown menu sets the current ")+_("viewable duration")+"</td></tr><tr><td>3. "+_("Click 'Load file' button or drop a new file ")+_("to view another set of data")+"</td></tr>";b+="</table></div>",b+="<div class='helpOk'><button class='btn btn-default'type='button' onclick= '$(&quot;#helpWinButton&quot;).click();$(&quot;#blackOverlay&quot;).hide();'><text>"+_("Ok")+"</text></button></div>",a.setAttribute("data-content",b),a.setAttribute("title",_("Help")),$("#helpWindowPopup").popover({placement:"bottom",trigger:"click"})},"function"==typeof require)var mne=require("../../src/mne.js");else $(document).ready(function(){mne.mneTranslate()});if(mne.stringsFR={"Web based EEG data browser":"Navigateur de données EEG sur le web","Login:":"Identifiant:",Login:"S'identifier",login:"identifiant",Password:"Mot de passe",password:"mot de passe","Load file":"Ouvrir un fichier","Select channels":"Sélection de canaux","EEG visualization made easy":"Visualisation de données EEG","Drop your EEG file here":"Déposez votre fichier EEG ici",or:"ou","Select a file to visualize":"Sélectionnez un fichier à visualiser","(Formats currently supported: EDF and BDF)":"(Formats actuellement pris en charge: EDF et BDF)","Only .edf and .bdf files are supported for now":"Fichiers .edf et .bdf Seuls sont pris en charge pour le moment","File Name":"Nom de fichier",Total:"Totale",Frame:"Durée",Absolute:"Absolue",Current:"Temps",Error:"Erreur","Invalid UserID":"Identifiant erronné","Invalid Password":"Mot de passe erronné","Try again":"Réessayer","Page duration":"Durée d'une page",Help:"Aide","Keyboard shortcuts":"Raccourcis clavier",Up:"Haut",Down:"Bas",Left:"Gauche",Right:"Droit",Shift:"Maj","Scroll up through the channels":"Voir les canaux plus haut","Scroll down through the channels":"Voir les canaux plus bas","Move backward in time by 1s":"Reculer dans le temps de 1s","Move forward in time by 1s":"Avancer dans le temps de 1s","Increase amplitude":"Augmenter l'amplitude","Decrease amplitude":"Diminuer l'amplitude","Move backward in time by 1 page":"Voir la page d'avant","Move forward in time by 1 page":"Voir la page d'après","Mouse events":"Utilisation de la souris","Mouse wheel up":"Molette de la souris vers le haut","Mouse wheel down":"Molette de la souris vers le bas",Interaction:"Intéractions","Click on a channel name to mark it bad":"Cliquez sur le nom d'un canal pour le marquer comme mauvais","'Page duration' dropdown menu sets the current ":"Le bouton 'Durée d'une page' permet de régler ","viewable duration":"la durée visible","Click 'Load file' button or drop a new file ":"Cliquez sur le bouton 'Ouvrir un fichier' ou déposez un nouveau fichier ","to view another set of data":"pour visualiser un nouveau jeu de données",Ok:"Ok","Choose channels to display":"Selection des canaux à afficher","Select/Deselect all":"Tout sélectionner/ déselectionner","Select at least one channel":"Sélectionnez au moins un canal","Powered by":"Réalisé avec",License:"Licence","Back to EEGDROP":"Retour à EEGDROP","All rights reserved.":"Tous droits réservés","authors of EEGDROP":"auteurs de EEGDROP",Authors:"Auteurs","This work is licensed under a ":"Ce travail est sous licence ","THERE IS NO WARRANTY; ":"IL N'Y A AUCUNE GARANTIE ","USE THIS SOFTWARE AT YOUR OWN RISK!":"QUANT A L'UTILISATION DE CE LOGICIEL","EEGDROP MAY NOT BE USED IN SAFETY-CRITICAL APPLICATIONS, ":"EEGDROP NE PEUT PAS ETRE UTILISE POUR DES APPLICATIONS METTANT EN JEU LA SANTE D'INDIVIDUS, ","SUCH AS LIFE-SUPPORT MEDICAL SYSTEMS.":"COMME DES SYSTEMES MEDICAUX.","THE AUTHORS ARE NOT RESPONSIBLE FOR ANY CONSEQUENCES.":"LES AUTEURS NE SONT PAS RESPONSABLES DES CONSÉQUENCES."},mne.mneFR=function(a){return a in mne.stringsFR?mne.stringsFR[a]:a},mne.mneEN=function(a){return a},mne.mneTranslate=function(){mne.lang=window.navigator.userLanguage||window.navigator.language,_=-1!==mne.lang.toLowerCase().indexOf("fr")?mne.mneFR:mne.mneEN;var a=$("title");a[0].innerHTML=_(a[0].innerHTML);for(var b=$("input"),c=$("text"),d=0;d<b.length;d++)b[d].value=_(b[d].value),b[d].placeholder=_(b[d].placeholder);for(d=0;d<c.length;d++)c[d].innerHTML=_(c[d].innerHTML)},"function"==typeof require)var mne=require("../../src/mne.js");if(mne.eegChans=["a1","a2","a3","a4","a5","a6","a7","a8","a9","a10","a11","a12","a13","a14","a15","a16","b1","b2","b3","b4","b5","b6","b7","b8","b9","b10","b11","b12","b13","b14","b15","b16","c1","c2","c3","c4","c5","c6","c7","c8","c9","c10","c11","c12","c13","c14","c15","c16","d1","d2","d3","d4","d5","d6","d7","d8","d9","d10","d11","d12","d13","d14","d15","d16","e1","e2","e3","e4","e5","e6","e7","e8","e9","e10","e11","e12","e13","e14","e15","e16","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","f13","f14","f15","f16","g1","g2","g3","g4","g5","g6","g7","g8","g9","g10","g11","g12","g13","g14","g15","g16","h1","h2","h3","h4","h5","h6","h7","h8","h9","h10","h11","h12","h13","h14","h15","h16","i1","i2","i3","i4","i5","i6","i7","i8","fp1","af7","af3","f1","f3","f5","f7","ft7","fc5","fc3","fc1","c1","c3","c5","t7","tp7","cp5","cp3","cp1","p1","p3","p5","p7","p9","po7","po3","o1","iz","oz","poz","pz","cpz","fpz","fp2","af8","af4","afz","fz","f2","f4","f6","f8","ft8","fc6","fc4","fc2","fcz","cz","c2","c4","c6","t8","tp8","cp6","cp4","cp2","p2","p4","p6","p8","p10","po8","po4","o2","eeg"],mne.nonEegChans=["spo2","emg","ecg","eog"],mne.isEegChan=function(a){for(var b=0;b<mne.nonEegChans.length;b++)if(-1!==a.toLowerCase().indexOf(mne.nonEegChans[b]))return!1;for(b=0;b<mne.eegChans.length;b++)if(-1!==a.toLowerCase().indexOf(mne.eegChans[b]))return!0;return!1},mne.Raw=function(a,b){this.scanner=a,this.fileType=b,this.scanner.littleEndian=!0,this.data=[]},mne.Raw.prototype.parseInfo=function(){var a={};a.info={},"edf"===this.fileType?a.info.icode=parseFloat(this.scanner.scanAttribute(this.scanner,"uchar",8)):"bdf"===this.fileType&&(a.info.icode=this.scanner.scan("uchar",8)),a.info.patientID=this.scanner.scanAttribute(this.scanner,"schar",80).trim();this.scanner.scanAttribute(this.scanner,"schar",80).trim();a.info.startDate=this.scanner.scanAttribute(this.scanner,"schar",8).trim(),a.info.startTime=this.scanner.scanAttribute(this.scanner,"schar",8).trim();parseFloat(this.scanner.scanAttribute(this.scanner,"schar",8)),this.scanner.scan("uchar",44);a.info.numRecords=parseFloat(this.scanner.scanAttribute(this.scanner,"char",8));var b=parseFloat(this.scanner.scanAttribute(this.scanner,"char",8));a.info.maxDuration=a.info.numRecords*b,a.info.nchan=parseFloat(this.scanner.scanAttribute(this.scanner,"char",4)),a.info.chanNames=this.scanner.scanStringAttributeArray(this.scanner,a.info.nchan,"char",16);this.scanner.scanStringAttributeArray(this.scanner,a.info.nchan,"char",80);a.info.units=this.scanner.scanStringAttributeArray(this.scanner,a.info.nchan,"char",8);var c=this.scanner.scanFloatAttributeArray(this.scanner,a.info.nchan,"char",8),d=this.scanner.scanFloatAttributeArray(this.scanner,a.info.nchan,"char",8),e=this.scanner.scanFloatAttributeArray(this.scanner,a.info.nchan,"char",8),f=this.scanner.scanFloatAttributeArray(this.scanner,a.info.nchan,"char",8);a.info.sfreqRecord=[],a.info.sfreq=[],a.info.lowpass=[],a.info.highpass=[];var g,h;for(g=0;g<a.info.nchan;g++)h=this.scanner.scanAttribute(this.scanner,"char",80).trim(),a.info.lowpass[g]=String(h.match(/LP:\s+(\w+)/g)).split(" ").slice(-1)[0],a.info.highpass[g]=String(h.match(/HP:\s+(\w+)/g)).split(" ").slice(-1)[0];for(g=0;g<a.info.nchan;g++)a.info.sfreqRecord[g]=parseFloat(this.scanner.scanAttribute(this.scanner,"char",8)),a.info.sfreq[g]=a.info.sfreqRecord[g]/b,a.info.lowpass[g]=a.info.lowpass[g].localeCompare("NaN")||a.info.lowpass[g].localeCompare("DC")?a.info.sfreqRecord[g]/2:parseFloat(a.info.lowpass[g]),a.info.highpass[g]=a.info.highpass[g].localeCompare("NaN")||a.info.highpass[g].localeCompare("DC")?0:parseFloat(a.info.highpass[g]);var i;for(g=0;g<a.info.nchan;g++)i=this.scanner.scan("char",32);for(a.info.channels=[],g=0;g<a.info.nchan;g++){var j="nonEeg";mne.isEegChan(a.info.chanNames[g])&&(j="eeg"),a.info.channels.push({name:a.info.chanNames[g],chanType:j,pos:[1,2,3],isChanGood:!0,isChecked:!0})}for(a.info.scaleFac=[],g=0;g<a.info.nchan;g++)a.info.scaleFac[g]=(d[g]-c[g])/(f[g]-e[g]),"uV"===a.info.units[g]&&(a.info.scaleFac[g]*=1e-6),"nonEeg"===a.info.channels[g].chanType&&(a.info.scaleFac[g]=1);for(this.info=a.info,this.data=new Array(a.info.nchan),g=0;g<a.info.nchan;g++)this.data[g]=[];var k=10;this.maxIterations=Math.ceil(a.info.numRecords/k),this.iterationsDone=0},mne.Raw.prototype.parseRecord=function(){var a,b,c,d,e,f,g=Math.min(this.maxIterations,this.info.numRecords-this.iterationsDone);if("edf"===this.fileType)for(d=0;g>d;d++){for(e=0;e<this.info.nchan;e++)for(a=this.info.sfreqRecord[e],scaleFac=this.info.scaleFac[e],c=this.scanner.scan("sshort",a),f=0;a>f;f++)this.data[e].push(c[f]*scaleFac);this.iterationsDone++}else if("bdf"===this.fileType){var h=1<<24,i=1<<23;for(d=0;g>d;d++){for(e=0;e<this.info.nchan;e++)for(a=3*this.info.sfreqRecord[e],scaleFac=this.info.scaleFac[e],c=this.scanner.scan("uchar",a),f=0;a>f;f+=3)b=c[f]+(c[f+1]<<8)+(c[f+2]<<16),b=b>=i?b-h:b,this.data[e].push(b*scaleFac);this.iterationsDone++}}return this.iterationsDone===this.info.numRecords?!1:!0},"function"==typeof require)var mne=require("../../src/mne.js");if(mne.Scanner=function(a){this.data=a,this.dataPointer=0,this.nativeLittleEndian=new Int8Array(new Int16Array([1]).buffer)[0]>0,this.littleEndian=!1},mne.Scanner.prototype.scanAttribute=function(a,b,c){var d,e="";d=a.scan(b,c);for(var f=d.length,g=0;f>g;g++)e+=String.fromCharCode(d[g]);return e},mne.Scanner.prototype.scanStringAttributeArray=function(a,b,c,d){for(var e=[],f=0;b>f;f++)e[f]=this.scanAttribute(a,c,d).trim();return e},mne.Scanner.prototype.scanFloatAttributeArray=function(a,b,c,d){for(var e=[],f=0;b>f;f++)e[f]=parseFloat(this.scanAttribute(a,c,d));return e},mne.Scanner.prototype.scan=function(a,b){"undefined"==typeof b&&(b=1);var c=1,d=Uint8Array;switch(a){case"uchar":break;case"schar":d=Int8Array;break;case"ushort":d=Uint16Array,c=2;break;case"sshort":d=Int16Array,c=2;break;case"uint":d=Uint32Array,c=4;break;case"sint":d=Int32Array,c=4;break;case"float":d=Float32Array,c=4;break;case"float64":d=Float64Array,c=8}var e=new d(this.data.slice(this.dataPointer,this.dataPointer+=b*c));return this.nativeLittleEndian!==this.littleEndian&&(e=this.flipEndianness(e,c)),1===b?[e[0]]:e},mne.Scanner.prototype.flipEndianness=function(a,b){for(var c=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),d=0;d<a.byteLength;d+=b)for(var e=d+b-1,f=d;e>f;e--,f++){var g=c[f];c[f]=c[e],c[e]=g}return a},"undefined"==typeof mne)var mne={};var _;if(mne.dropZoneOn=function(){dropZoneText.style.background="steelblue"},mne.dropZoneOff=function(){dropZoneText.style.background="lightsteelblue"},mne.initializeFileSelect=function(){document.getElementById("fileSelector").addEventListener("change",mne.handleFileSelection,!1)},mne.initializeDragDrop=function(){var a=document.getElementById("main"),b=document.getElementById("dropZoneText");a.addEventListener("dragover",mne.handleFileDrag,!1),a.addEventListener("drop",mne.handleFileDrop,!1),b.ondragover=function(){mne.dropZoneOn()},b.ondragleave=function(){mne.dropZoneOff()}},mne.addMarkerListener=function(a,b){null!=a.text&&a.text.addEventListener("click",function(){b.colorChannel(a)})},mne.initiateChanMarker=function(a){for(var b=[],c=[],d=[],e=Math.min(a.chanPerPage,a.numChan-a.activeChan[0]),f=0;e>f;f++){b[f]=document.getElementById("text-"+f),c[f]=document.getElementById("path-"+f),d[f]=document.getElementById("axis-"+f);var g={index:a.activeChan[0]+f,text:b[f],path:c[f],axis:d[f]};mne.addMarkerListener(g,a)}},mne.triggerRescaling=function(a){var b=a.tMin+a.windowLen;b>a.maxDuration?(a.tMin=Math.max(0,a.maxDuration-a.windowLen),a.tMax=a.maxDuration):a.tMax=a.tMin+a.windowLen,a.redrawOnScaling()},mne.catchDurationSelect=function(a){$(".dropdown-menu li a").click(function(){var b=parseFloat($(this).text());a.maxDuration>=b&&a.windowLen!==b&&(a.windowLen=b,mne.triggerRescaling(a))})},mne.catchKeyPress=function(){if(mne.isListenerOn!==!0){var a={16:!1,38:!1,40:!1,37:!1,39:!1,191:!1,27:!1,13:!1};$(window).bind("mousewheel DOMMouseScroll",function(a){a.shiftKey?a.originalEvent.wheelDelta>0||a.originalEvent.detail<0?mne.plotGraph.backward(!0):mne.plotGraph.forward(!0):a.originalEvent.wheelDelta>0||a.originalEvent.detail<0?mne.plotGraph.upward():mne.plotGraph.downward()}),$(document).keydown(function(b){b.keyCode in a&&(a[b.keyCode]=!0,a[16]&&a[38]&&mne.plotGraph.incGain(),a[16]&&a[40]&&mne.plotGraph.decGain(),a[16]&&a[39]&&mne.plotGraph.forward(!1),a[16]&&a[37]&&mne.plotGraph.backward(!1),a[39]&&mne.plotGraph.forward(!0),a[37]&&mne.plotGraph.backward(!0),a[38]&&!a[16]&&mne.plotGraph.upward(),a[40]&&!a[16]&&mne.plotGraph.downward(),a[16]&&a[191]&&mne.isChanSelectDone===!0&&($("#helpWindowPopup").click(),$("#blackOverlay").toggle()),(a[13]||a[27])&&("block"===$("#blackOverlay").css("display")&&$("#chanSelConfirm").click(),$("#blackOverlay").hide(),$("#chanSelectPopup").popover("hide"),$("#helpWindowPopup").popover("hide")))}).keyup(function(b){b.keyCode in a&&(a[b.keyCode]=!1)}),mne.isListenerOn=!0}},"function"==typeof require&&(module.exports=mne),"function"==typeof require)var mne=require("../../src/mne.js");mne.RawPlotter=function(a,b,c){c||(c={}),this.raw=a,this.selector=b,this.options=c,this.fileName=this.raw.info.fileName,this.data=[],this.channels=[],this.chanNames=this.raw.info.chanNames;for(var d=0;d<this.raw.info.nchan;d++)a.info.channels[d].isChecked&&(this.channels.push(this.raw.info.channels[d]),this.data.push(this.raw.data[d])),a.info.channels[d].isChecked=!0;this.numChan=this.channels.length,this.sfreq=this.raw.info.sfreq,this.margin={top:0,right:0,bottom:25,left:70},this.chanPerPage=c.chanPerPage||Math.min(15,this.numChan),this.maxDuration=this.raw.info.maxDuration;var e=this.maxDuration<10?2:10;this.windowLen=c.windowLen||e,this.isSmallDuration=this.maxDuration<2?!0:!1;var f=[1,2,10,30,60];for(durationElement=document.getElementById("duration-menu"),durationElement.innerHTML="",d=0;d<f.length;d++){var g=f[d];g<=this.maxDuration&&(durationElement.innerHTML+="<li><a>"+g+"s</a></li>")}this.startDate=this.raw.info.startDate,this.startTime=this.raw.info.startTime,this.setTimeStamp(),this.forwardLimit=this.maxDuration,this.backwardLimit=0,this.upLimit=this.chanPerPage,this.downLimit=this.numChan-this.chanPerPage-1,this.tMin=0,this.tMax=this.windowLen,this.currentSliderPos=0,this.gain=[],this.numBadChan=0;var h=Number.MIN_VALUE;for(d=0;d<this.numChan;d++){this.gain.push(1);var i=this.channels[d].chanType;"nonEeg"===i&&(this.numBadChan+=1);var j=this.data[d].length;j>h&&(h=j)}for(this.gainMultiplier=1.5,this.badChannelColor="rgba(145, 145, 145, 0.30)",this.sampleChunkSize=Math.round(h/2e3),this.numSampleChunks=Math.round(h/this.sampleChunkSize),this.downSampleSumData(),this.activeChan=[],d=0;d<this.chanPerPage;d++)this.activeChan.push(d);this.removeDC(),this.setEegdomain()},mne.RawPlotter.prototype.setup=function(){this.svgWidth=document.getElementById("graph").clientWidth,this.width=this.svgWidth-this.margin.left-this.margin.right,this.svgHeight=document.getElementById("graph").clientHeight,this.height=this.svgHeight-this.margin.top-this.margin.bottom,this.plotSpacing=this.height/this.chanPerPage,this.textFont=this.svgHeight/40,document.getElementById("fileName").setAttribute("style","font-size:"+this.textFont+"px"),document.getElementById("toolTipText").setAttribute("style","font-size:"+this.textFont+"px"),$(".btn").css("font-size",this.textFont+"px");var a=.0086;this.slidNegMarg=this.svgHeight*a,document.getElementById("interaction").setAttribute("style","margin-bottom:"+this.slidNegMarg+"em"),this.yOffset=[],this.textOffsetArr=[];for(var b=this.svgHeight/40,c=0;c<this.chanPerPage;c++)this.yOffset.push(c*this.plotSpacing),this.textOffsetArr.push(this.yOffset[c]+b);this.setEegLines(),this.graph=d3.select(this.selector).append("svg").attr("width",this.svgWidth+10).attr("height",this.svgHeight).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.drawToolTip()},mne.RawPlotter.prototype.draw=function(){{var a=this.dataSliceTime(this.dataSliceChan());this.chanNames.slice(this.activeChan[0],this.activeChan[this.chanPerPage])}this.graph.selectAll("text").remove(),this.graph.selectAll("path").remove();var b=Math.min(this.chanPerPage,this.numChan-this.activeChan[0]),c=this.svgWidth/43;for(i=0;i<b;i++){for(var d=[],e=0;e<a[i].length;e++)a[i][e]*=this.gain[i],d.push(0);var f=i+this.activeChan[0];switch(this.currentSfreq=this.sfreq[f],this.channels[f].chanType){case"eeg":this.line=this.lineEeg;break;case"nonEeg":this.line=this.getNonEegLine(f)}this.graph.append("text").attr("id","text-"+i).attr("transform","translate(-"+c+","+this.textOffsetArr[i]+")").text(this.channels[f].name).style({fill:this.channels[f].isChanGood?"black":this.badChannelColor,"font-size":this.textFont+"px"}),this.graph.append("path").attr("id","path-"+i).attr("transform","translate(0,"+this.yOffset[i]+")").style({stroke:this.channels[f].isChanGood?"steelblue":this.badChannelColor}).attr("d",this.line(a[i])),this.graph.append("path").attr("id","axis-"+i).attr("transform","translate(0,"+this.yOffset[i]+")").style({stroke:this.channels[f].isChanGood?"grey":this.badChannelColor}).attr("d",this.line(d))}var g=document.getElementById("fileName");g.innerHTML="<b>"+_("File Name")+"</b> : <a id='fileNamePopover' data-content='"+this.fileName+"' rel='popover'data-placement='left' data-trigger='hover'>"+this.fileName+"</a>",$("#fileNamePopover").popover(),document.getElementById("fileNamePopover").setAttribute("style","font-size:"+this.textFont+"px"),mne.initiateChanMarker(this)},mne.RawPlotter.prototype.drawSlider=function(){function a(){var a=h.extent()[0];if(d3.event.sourceEvent){var d=a;a=Math.round(f.invert(d3.mouse(this)[0])),a=Math.min(Math.max(0,a-Math.round(b.windowLen/2)),c),h.extent([a,a]),d===a||this.isSmallDuration||b.redrawOnSlide(a)}m.attr("x",f(a))}document.getElementById("sliderDiv").innerHTML="";var b=this,c=this.maxDuration-this.windowLen,d=this.maxDuration,e=10;this.sliderSvgWidth=this.svgWidth+10,this.sliderSvgHeight=this.svgHeight/10;var f=d3.scale.linear().domain([0,d]).range([0,this.width]).clamp(!0),g=d3.select("#sliderDiv").append("svg").attr("width",this.sliderSvgWidth).attr("height",this.sliderSvgHeight).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")");g.append("g").attr("class","x axis").attr("transform","translate(0,"+this.sliderSvgHeight/2+")").call(d3.svg.axis().scale(f).orient("bottom").ticks(0).tickSize(0)).select(".domain").attr("class","halo");var h=d3.svg.brush().x(f).extent([0,0]).on("brush",a);this.brush=h,this.slider=g.append("g").attr("class","slider").call(h),this.slider.select(".background").attr("height",this.sliderSvgHeight/2).style("cursor","move");var i=(this.sliderSvgHeight-e)/2,j=this.svgWidth-this.margin.left,k=5,l=Math.max(k,Math.min(j,this.windowLen*j/this.maxDuration)),m=this.slider.append("rect").attr("class","handle").attr("width",l).attr("height",e).attr("transform","translate(0,"+i+")")},mne.RawPlotter.prototype.moveSlider=function(a){(this.currentSliderPos!==this.tMin||a)&&(this.slider.call(this.brush.event).call(this.brush.extent([this.tMin,this.tMin])).call(this.brush.event),this.currentSliderPos=this.tMin)},mne.RawPlotter.prototype.plotSumData=function(){document.getElementById("sumPlot").innerHTML="",document.getElementById("sumPlot").setAttribute("style","margin-top:"+-.5*this.slidNegMarg+"em");var a=this.svgHeight/10,b=d3.scale.linear().domain([0,this.maxDuration]).range([0,this.width]),c=d3.scale.linear().domain([d3.min(this.sumData),d3.max(this.sumData)]).range([a,0]),d=d3.max(this.sfreq)/this.sampleChunkSize;this.sumPlotSVG=d3.select("#sumPlot").append("svg").attr("width",this.svgWidth).attr("height",a).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.sumArea=d3.svg.area().x(function(a,c){return b(c/d)}).y0(a).y1(function(a){return c(a)}),this.sumLine=d3.svg.line().x(function(a,c){return b(c/d)}).y(function(a){return c(a)}),this.sumPlotSVG.append("path").datum(this.sumData).attr("class","area").attr("d",this.sumArea),this.sumPlotSVG.append("path").attr("id","sumPath").style({stroke:"black"}).attr("d",this.sumLine(this.sumData))},mne.RawPlotter.prototype.redrawPlotSumData=function(a,b){var c=this.channels[a].chanType;if("nonEeg"!==c){var d;if(this.numBadChan===this.numChan)for(d=0;d<this.numSampleChunks;d++)this.sumData[d]=0;else{var e,f,g,h,i;for(d=0;d<this.numSampleChunks;d++){e=0,g=d*this.sampleChunkSize,h=g,i=g+this.sampleChunkSize;for(var j=h;i>j&&!isNaN(this.data[a][j]);j++)e+=Math.pow(this.data[a][j],2);f=Math.pow(this.sumData[d],2),b?f+=e/this.sampleChunkSize:f-=e/this.sampleChunkSize,this.sumData[d]=Math.sqrt(Math.max(0,f))}}this.plotSumData()}},mne.RawPlotter.prototype.drawToolTip=function(){var a=this,b=d3.scale.linear().domain([0,this.windowLen]).range([0,this.width]).clamp(!0),c=this.graph.append("g").style("display","none");c.append("line").attr("class","x").style("stroke","black").style("stroke-dasharray","3,3").attr("y1",0).attr("y2",this.height),this.graph.append("rect").attr("width",this.width).attr("height",this.height).style("fill","none").style("pointer-events","all"),this.graph.on("mouseover",function(){c.style("display","block")}).on("mouseout",function(){c.style("display","none")}).on("mousemove",function(){a.toolTipX=b.invert(d3.mouse(this)[0]),c.select("line.x").attr("transform","translate("+b(a.toolTipX)+", 0)"),a.changeToolTipText()})},mne.RawPlotter.prototype.changeToolTipText=function(){var a=document.getElementById("toolTipText"),b=parseInt(1e3*(this.toolTipX+this.tMin));a.innerHTML="<a id='toolTipPopover' data-content='"+_("Total")+": "+mne.quantizeSeconds(this.maxDuration,!1)+"&nbsp&nbsp&nbsp "+_("Absolute")+": "+this.getAbsoluteTime(b)+"' rel='popover' data-placement='top' data-trigger='hover'><b>"+_("Frame")+"</b>: "+mne.quantizeSeconds(this.tMin,!1)+" - "+mne.quantizeSeconds(this.tMax,!1)+"&nbsp&nbsp<b>"+_("Current")+"</b>: "+mne.quantizeSeconds(b,!0)+"</a>",$("#toolTipPopover").popover(),document.getElementById("toolTipPopover").setAttribute("style","font-size:"+this.textFont+"px")},mne.RawPlotter.prototype.forward=function(a){if(!this.isSmallDuration){var b=a?1:this.windowLen-1;this.tMax+b>this.maxDuration?(this.tMax=this.maxDuration,this.tMin=Math.max(0,this.maxDuration-this.windowLen),this.draw(),this.moveSlider()):this.tMax<this.forwardLimit&&(this.tMin+=b,this.tMax+=b,this.draw(),this.moveSlider()),this.changeToolTipText()}},mne.RawPlotter.prototype.backward=function(a){if(!this.isSmallDuration){var b=a?1:this.windowLen-1;this.tMin-b<0?(this.tMin=0,this.tMax=Math.min(this.windowLen,this.maxDuration),this.draw(),this.moveSlider()):this.tMin>this.backwardLimit&&(this.tMin-=b,this.tMax-=b,this.draw(),this.moveSlider()),this.changeToolTipText()}},mne.RawPlotter.prototype.upward=function(){if(this.activeChan[0]>=this.upLimit){for(var a=0;a<this.chanPerPage;a++)this.activeChan[a]-=this.chanPerPage;this.draw()}},mne.RawPlotter.prototype.downward=function(){var a=this.activeChan.slice(-1)[0];if(a<=this.downLimit||a<this.numChan-1){for(var b=0;b<this.chanPerPage;b++)this.activeChan[b]+=this.chanPerPage;this.draw()}},mne.RawPlotter.prototype.incGain=function(){for(var a=0;a<this.numChan;a++)this.gain[a]*=this.gainMultiplier;this.draw()},mne.RawPlotter.prototype.decGain=function(){for(var a=0;a<this.numChan;a++)this.gain[a]/=this.gainMultiplier;this.draw()},mne.RawPlotter.prototype.dataSliceTime=function(a){for(var b=[],c=Math.min(this.chanPerPage,this.numChan-this.activeChan[0]),d=0;c>d;d++){var e=this.sfreq[this.activeChan[d]];b.push(a[d].slice(this.tMin*e,this.tMax*e+1))}return b},mne.RawPlotter.prototype.dataSliceChan=function(){return this.data.slice(this.activeChan[0],this.activeChan[this.chanPerPage])},mne.RawPlotter.prototype.redrawOnResize=function(){var a=this;window.onresize=function(){document.getElementById("graph").innerHTML="",a.setup(),a.draw(),a.drawSlider(),a.moveSlider(!0),a.plotSumData(),a.changeToolTipText()}},mne.RawPlotter.prototype.redrawOnScaling=function(){document.getElementById("graph").innerHTML="",this.setup(),this.draw(),this.drawSlider(),this.moveSlider(!0)},mne.RawPlotter.prototype.redrawOnSlide=function(a){this.tMin=a,this.tMax=a+this.windowLen,this.draw(),this.moveSlider()},mne.RawPlotter.prototype.colorChannel=function(a){this.channels[a.index].isChanGood=!this.channels[a.index].isChanGood;var b=this.channels[a.index].chanType;this.channels[a.index].isChanGood?(a.text.setAttribute("style","fill:black;font-size:"+this.textFont+"px"),a.path.setAttribute("style","stroke:steelblue"),a.axis.setAttribute("style","stroke:grey"),"eeg"===b&&(this.numBadChan-=1),this.redrawPlotSumData(a.index,!0)):(a.text.setAttribute("style","fill:"+this.badChannelColor+";font-size:"+this.textFont+"px"),a.path.setAttribute("style","stroke:"+this.badChannelColor),a.axis.setAttribute("style","stroke:"+this.badChannelColor),"eeg"===b&&(this.numBadChan+=1),this.redrawPlotSumData(a.index,!1))
},mne.RawPlotter.prototype.downSampleSumData=function(){for(var a,b,c,d=[],e=0;e<this.numSampleChunks;e++){for(d.push(0),a=e*this.sampleChunkSize,b=a,c=a+this.sampleChunkSize,i=0;i<this.numChan;i++){var f=this.channels[i].chanType;if("eeg"===f)for(var g=b;c>g&&!isNaN(this.data[i][g]);g++)d[e]+=Math.pow(this.data[i][g],2)}d[e]=Math.sqrt(d[e]/this.sampleChunkSize)}this.sumData=d.slice()},mne.RawPlotter.prototype.removeDC=function(){for(i=0;i<this.numChan;i++){var a=this.data[i].reduce(function(a,b){return a+b},0),b=this.data[i].length,c=a/b;for(j=0;j<b;j++)this.data[i][j]-=c}},mne.RawPlotter.prototype.setEegdomain=function(){var a=Number.MAX_VALUE,b=Number.MIN_VALUE;for(i=0;i<this.numChan;i++)if("eeg"===this.channels[i].chanType)for(j=0;j<this.data[i].length;j++)b=Math.max(b,this.data[i][j]),a=Math.min(a,this.data[i][j]);this.maxYEeg=Math.max(Math.abs(b),Math.abs(a)),this.minYEeg=-this.maxYEeg},mne.RawPlotter.prototype.setEegLines=function(){var a=d3.scale.linear().domain([0,this.windowLen]).range([0,this.width]),b=d3.scale.linear().domain([this.minYEeg,this.maxYEeg]).range([this.height/this.chanPerPage,0]);this.lineEeg=d3.svg.line().x(function(b,c){return a(c/this.currentSfreq)}).y(function(a){return b(a)})},mne.RawPlotter.prototype.getNonEegLine=function(a){var b=d3.scale.linear().domain([0,this.windowLen]).range([0,this.width]),c=d3.min(this.data[a]),d=d3.max(this.data[a]);d=Math.max(Math.abs(d),Math.abs(c)),c=-d;var e=d3.scale.linear().domain([c,d]).range([this.height/this.chanPerPage,0]),f=d3.svg.line().x(function(a,c){return b(c/this.currentSfreq)}).y(function(a){return e(a)});return f},mne.RawPlotter.prototype.setTimeStamp=function(){var a,b,c,d,e,f,g,h;a=this.startTime.split("."),b=a[0],c=a[1],d=a[2],e=this.startDate.split("."),f=e[0],g=e[1],h=e[2],this.timeStamp=new Date(h,g,f,b,c,d)},mne.RawPlotter.prototype.getAbsoluteTime=function(a){var b=new Date(this.timeStamp);return b.setMilliseconds(b.getMilliseconds()+a),absTime=b.getHours()+":"+b.getMinutes()+":"+b.getSeconds(),absTime},mne.quantizeSeconds=function(a,b){var c;b&&(c=a%1e3,a=parseInt(a/1e3));var d=parseInt(a/3600),e=parseInt(a/60)%60,f=a%60,g=(d>0?d+"h ":"")+(e>0?e+"m ":"")+(f+"s ");return b&&(g=g+c+"ms"),g};